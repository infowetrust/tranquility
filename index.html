
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Neil & Buzz</title>
	<meta name="description" content="Scrollama: Sticky Overlay Example">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel='stylesheet' href='style.css'>
</head>

<body>
	<main>
		<section id='intro'>
            <h1 class='intro__hed'>Neil & Buzz Take a Walk</h1>
            <h3 class='intro__credit'>A data story by RJ Andrews.</h3>
			<p class='intro__dek'>
                    <br>The hatch of Apollo 11’s Lunar Module <i>Eagle</i> was open for 2 hours and 32 minutes on the surface of the Moon.<br>
                    <br>
                    During that time <span class="n">&nbsp;NEIL ARMSTRONG&nbsp;</span> and <span class="b">&nbsp;BUZZ ALDRIN&nbsp;</span> explored an area about the size of a baseball diamond called <i>Tranquility Base</i> before blasting back to <span class="m">MICHAEL COLLINS</span>, orbiting above in the Command Module.<br><br>
            </p>
            <p class="intro__call">SCROLL TO SEE THEIR ADVENTURE.</p>
        </section>

        <div class="header" id="labels">    
            <div class="header-p">
                <p>
                    <span class="armstrong">NEIL</span>
                    <span class="aldrin">BUZZ</span>
                </p><br>
                <p>
                    <!--<span class="armstrong">ARMSTRONG</span>
                    <span class="aldrin">ALDRIN</span>-->
                </p>
            </div>
        </div>

        <div class="header-c" id="collins">
                <p>
                    <span class="collins">MIKE</span><br>
                </p>
        </div>

        <div class="footer" id="time">    
            <p>
                <span class="time-l" id="timel">00:00</span>
                <span class="time-r" id="timer">02:32</span>
            </p>
        </div>

		<section id='scrolly'>

			<figure>
                <!--<p>0</p>-->
                <img src="media/Moon-0.jpg" id="moon" width="100%"> 
			</figure>

            <!--Transcript goes here-->
			<article>
                <div class='step' data-step='0'>
                    <p>hr:mn</p>
                    <ul>
                        <li class="comment">Highlights from the Apollo 11 Transcript are color-coded to speaker and presented with time since hatch opening in hour:minute format.</li>
                    </ul>
                </div>
                <div class='step' data-step='1'>
                    <p>00:00</p>
                    <ul>
                        <li class="neil">The hatch is coming open.</li>
                        <li class="comment">...</li>
                        <li class="buzz">About ready to go down and get some Moon rock?</li>
                    </ul>
                    
				</div>
				<div class='step' data-step='2'>
                    <p>00:16</p>
                    <ul>
                        <li class="neil">I’m at the foot of the ladder. The LM footpads are only depressed in the surface about 1 or 2 inches, although the surface appears to be very, very fine grained, as you get close to it. It’s almost like a powder. Down there, it’s very fine.</li>
                        <li class="comment">LM ("LEM") stands for Lunar Module.</li>
                        <li class="neil">I’m going to step off the LM now.</li>
                        <li class="neil">THAT'S ONE SMALL STEP FOR (A) MAN, ONE GIANT LEAP FOR MANKIND</li>
                        <li class="neil">And the - the surface is fine and powdery. I can - I can pick it up loosely with my toe. It does adhere in fine layers like powdered charcoal to the sole and sides of my boots. I only go in a small fraction of an inch, maybe an eighth of an inch, but I can see the footprints of my boots and the treads in the fine, sandy particles.</li>
                    </ul>
                    
				</div>
				<div class='step' data-step='3'>
                    <p>00:27</p>
                    <ul>
                        <li class="buzz">That looks beautiful from here, Neil.</li>
                        <li class="neil">It has a stark beauty all its own. It’s like much of the high desert of the United States. It’s different but it’s very pretty out here. </li>
                        <!--Be advised that a lot of the rock samples out here, the hard rock samples, have what appear to be vesicles in the surface. Also, I am looking at one now that appears to have some sort of phenocryst.-->
                    </ul>
                </div>
                <div class='step' data-step='4'>
                        <p>00:34</p>
                        <ul>
                            <li class="buzz">Okay. Now I want to back up and partially close the hatch.</li>
                            <li class="buzz">Making sure not to lock it on my way out.</li>
                            <li class="neil">(Laughter) A pretty good thought.</li>
                        </ul>
                        <img src="media/ladder.jpg" alt="none" class="img-n">
                        <ul>
                            <li class="comment">The best photos are of Buzz because Neil was in charge of the Hasselblad camera.</li>
                            <li class="buzz">That’s our home for the next couple of hours and we want to take good care of it.</li>
                            <li class="comment">...</li> 
                            <li class="neil">A little more. About another inch.</li>
                            <li class="neil">THERE YOU GOT IT.</li>
                            <li class="neil">That’s a good step. About a 3-footer.</li>
                            <li class="buzz">Beautiful view!</li>
                            <li class="neil">Isn’t that something! Magnificent sight out here.</li>
                            <li class="buzz">Magnificent desolation.</li>
                        </ul>

                </div>
                <div class='step' data-step='5'>
                        <p>00:49</p>
                        <ul>
                            <li class="comment">Aldrin feeds Armstrong cable to TV camera.</li>
                            <li class="buzz">Now keep going. We've got a lot more.</li>
                            <li class="neil">Okay.</li>
                            <li class="buzz">Getting a little harder to pull out, here.</li>
                            <li class="neil">How far would you say I am, Buzz?</li>
                            <li class="buzz">Forty, 50 feet. Why don't you turn around and let them get a view from there and see what the field of view looks like?</li>
                            <li class="comment"> ...</li>
                            <li class="capcom">Neil, this is Houston. The field of view is okay. We'd like you to aim it a little bit more to the right. Over.</li>
                            <li class="neil">Okay.</li>
                            <li class="buzz">Okay. That's all the cable we have. *** not going out. I'll start working on the solar wind - -</li>
                            <li class="capcom">A little bit too much to the right. Can you bring it back left about 4 or 5 Degrees?</li>
                            <li class="capcom">Okay. That looks good Neil.</li>
                            <li class="neil">Okay, now. Do you think I ought to be farther away, or closer?</li>
                            <li class="buzz">Can't get too much further away.</li>
                            <li class="neil">Let's try it like that for a while. I'll get a couple of panoramas with it, here.</li>
                            <!--tk put panorama shot here-->
                        </ul>
                </div>
                <div class='step' data-step='6'>
                        <p>00:54</p>
                        <ul>
                            <li class="neil"> How's that for a final?</li>
                            <li class="capcom"> For a final orientation, we'd like it to come left about 5 degrees. Over.</li>
                            <li class="capcom"> Now back to the right about half as much.</li>
                            <li class="neil"> Okay?</li>
                            <li class="capcom"> Okay. That looks good there, Neil.</li>
                            <li class="neil"> Okay.</li>
                            <li class="buzz"> Okay. You can make a Mark, Houston. *** deployed.</li>
                            <li class="capcom"> Roger. Solar wind.</li>
                            <img src="media/solarwind.jpg" alt="none" class="img-n">
                        </ul>
                </div>
                <div class='step' data-step='7'>
                    <p>01:01</p>
                    <ul>
                        <li class="capcom"> Columbia, this is Houston. Reading you loud and clear. Over.</li>
                    </ul>

                    <img src="media/collins-yellow.png" alt="none" id="orbit" class="module"></img>
                    
                    <ul>
                        <li class="mike"> Yes. Reading you loud and clear. How's it going?</li>
                        <li class="capcom"> Roger. The EVA is progressing beautifully. I believe they are setting up the flag now.</li>
                        <li class="mike"> Great.</li>
                        <li class="capcom"> I guess you're about the only person around that doesn't have TV coverage of the scene.</li>
                        <li class="mike"> That's all right. I don't mind a bit.</li>
                        <li class="mike"> How is the quality of the TV?</li>
                        <li class="capcom"> Oh, it's beautiful, Mike. It really is.</li>
                        <li class="mike"> Oh, gee, that's great! Is the lighting half way decent?</li>
                        <li class="capcom"> Yes, indeed. They've got the flag up now and you can see the stars and stripes on the lunar surface.</li>
                        <li class="mike"> Beautiful. Just beautiful.</li>
                    </ul>

                    <img src="media/flag.png" alt="none" class="img-c">
                </div>

				<div class='step' data-step='8'>
                    <p>01:24</p>
                    <ul>
                        <li class="buzz">And right in this area, there are two craters. The one that's right in front of me now as I look off in about the eleven o'clock position from the spacecraft, about 30 to 35 feet ... There's several rocks and boulders 6 to 8 inches across.</li>
                        <li class="comment">...</li>
                        <li class="buzz">How's the bulk sample coming, Neil?</li>
                        <li class="neil">Bulk sample is just being sealed.</li>
                    </ul>
                </div>
                
                <div class='step' data-step='9'>
                    <p>END</p>
                </div>
                
                <div class='step' data-step='10'>
                    <p>STEP 10</p>

                    
				</div>
			</article>

			
		</section>

		<section id='credits'>
            <p class='outro'>
                    Roll credits
            </p>
        </section>
	</main>
	
	<!-- <div class='debug'></div> -->
	<script src='https://unpkg.com/d3@5.9.1/dist/d3.min.js'></script>
    <script src='https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js'></script>
    <script src='stickyfill.min.js'></script>
    <script src='scrollama.min.js'></script>

    <script>
		// using d3 for convenience
		var main = d3.select('main')
		var scrolly = main.select('#scrolly');
		var figure = scrolly.select('figure');
		var article = scrolly.select('article');
        var step = article.selectAll('.step');
        var figureHeight = window.innerWidth / 4;

        // initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
            // 1. update height of step elements
            //TK need to update this to length of text
			//var stepH = Math.floor(window.innerWidth * 0.75);
			//step.style('height', stepH + 'px');
 
            var figureMarginTop = (window.innerHeight - figureHeight);

			figure
				.style('height', figureHeight + 'px')
				.style('top', figureMarginTop + 'px');

			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

        // scrollama event handlers

        function handleStepEnter(response) {
			console.log(response)
			// response = { element, direction, index }

			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			})

			// update graphic based on step
            figure.select('p').text(response.index + 1);

            //hide footer
            var clock = document.getElementById("time");
            
            if (response.index >= 1 && response.index <10 ) {
                clock.style.opacity = 1;
                } else {
                clock.style.opacity = 0;
            }
            

            //update time based on step
            var times = [
                ["00:00","02:32"],
                ["00:00","02:32"],
                ["00:16","02:16"],
                ["00:27","02:05"],
                ["00:34","01:58"],
                ["00:49","01:43"],
                ["00:54","01:38"],
                ["01:01","01:31"],
                ["01:24","01:08"]
                ];

            document.getElementById("timel").textContent= times[response.index][0];

            document.getElementById("timer").textContent= times[response.index][1];

            //update moon image
            document.getElementById('moon').src = ("media/Moon-" + response.index + ".jpg");

            //make command module fly
            var element = document.getElementById("orbit");
            
            if (response.index == 7) {
                element.classList.add("slideLeft");
                } else {
                element.classList.remove("slideLeft");
            }

            //header label
            var header = document.getElementById("labels");
            
            if (response.index >= 1 && response.index <10 ) {
                header.style.opacity = 1;
                } else {
                header.style.opacity = 0;
            }

            var headercollins = document.getElementById("collins");

            if (response.index == 7 ) {
                headercollins.style.opacity = 1;
                } else {
                headercollins.style.opacity = 0;
            }
		}

		function setupStickyfill() {
			d3.selectAll('.sticky').each(function () {
				Stickyfill.add(this);
			});
		}

		function init() {
			setupStickyfill();
			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
				step: '#scrolly article .step',
				offset: .5, //trigger line
 				debug: true,
			})
				.onStepEnter(handleStepEnter)


			// setup resize event
			window.addEventListener('resize', handleResize);
		}

		// kick things off
		init();
	</script>
</body>

</html>
